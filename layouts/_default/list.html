
{{ define "main" }}
  {{- $pages := .RegularPages -}}
  {{- $paginator := .Paginate $pages -}}
  {{- $totalPosts := len .RegularPages -}}
  {{- $posts := $paginator.Pages -}}
  {{- $author := site.Params.author | default (dict) -}}
  {{- $tags := site.Taxonomies.tags | default dict -}}
  {{- $isTagList := eq .Section "tags" -}}
  {{- $tagName := .Title -}}
  <section class="mx-auto w-full max-w-6xl px-4 pb-16">
    <div class="list-layout">
      <div class="list-posts">
        {{- if $isTagList -}}
          <div class="page-header-wrapper">
            <a href="{{ "/blog/" | relLangURL }}" class="page-header-back">View all posts</a>
            <h1 class="page-title text-brand-text-heading">Posts tagged with "{{ $tagName }}"</h1>
          </div>
        {{- end -}}
        {{- if gt (len $posts) 0 -}}
          {{- range $posts -}}
            {{- $tagsForPost := .Params.tags | default slice -}}
            {{- $date := .Date | time.Format "Jan 2, 2006" -}}
            {{- $excerpt := .Summary -}}
            {{- if not $excerpt -}}
              {{- $excerpt = (.Plain | truncate 220) -}}
            {{- end -}}
            <article class="post-card">
              <div class="post-card__meta">
                <span class="post-card__tags">
                  {{- if gt (len $tagsForPost) 0 -}}
                    {{- range $index, $tagName := $tagsForPost -}}
                      {{- if $index -}}, {{ end -}}
                      {{- $tagURL := printf "/tags/%s/" ($tagName | urlize) | relLangURL -}}
                      <a href="{{ $tagURL }}">{{ $tagName }}</a>
                    {{- end -}}
                  {{- else -}}
                    <span class="post-card__tags--empty">No tags</span>
                  {{- end -}}
                </span>
                <span class="post-card__separator">â€”</span>
                <span class="post-card__date">{{ $date }}</span>
              </div>
              <header class="post-card__header">
                <h2 class="post-card__title">
                  <a href="{{ .RelPermalink }}" class="post-card__title-link">
                    {{ .Title }}
                  </a>
                </h2>
              </header>
              <p class="post-card__excerpt">{{ $excerpt | plainify }}</p>
            </article>
          {{- end -}}
        {{- else -}}
          <p class="list-empty">No posts published yet. Check back soon.</p>
        {{- end -}}
        {{- partial "pagination-controls.html" (dict "Page" . "Paginator" $paginator "TotalPosts" $totalPosts) -}}
      </div>
      {{- partial "list-sidebar.html" (dict "Page" . "Author" $author "Tags" $tags) -}}
    </div>
  </section>
{{ end }}

