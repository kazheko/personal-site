{{- $page := . -}}
{{- $tags := cond (isset $page.Params "tags") $page.Params.tags (slice) -}}
{{- if not $tags -}}
  {{- $tags = slice -}}
{{- end -}}
{{- $tagCount := len $tags -}}
{{- $fallbackDateCopy := default "Draft date TBD" $page.Params.fallback_date_copy -}}
{{- $dateDisplay := $fallbackDateCopy -}}
{{- $dateISO := "" -}}
{{- $lastmodDisplay := "" -}}
{{- $lastmodISO := "" -}}
{{- $publishDate := .PublishDate -}}
{{- if not $publishDate -}}
  {{- $publishDate = .Date -}}
{{- end -}}
{{- with $publishDate -}}
  {{- $dateDisplay = .Format "Jan 2, 2006" -}}
  {{- $dateISO = .Format "2006-01-02" -}}
{{- end -}}
{{- with .Lastmod -}}
  {{- if and $publishDate (ne .Unix $publishDate.Unix) -}}
    {{- $lastmodDisplay = .Format "Jan 2, 2006" -}}
    {{- $lastmodISO = .Format "2006-01-02" -}}
  {{- end -}}
{{- end -}}
<div class="post-card__meta">
  <span class="post-card__tags" aria-label="Post tags">
    <span class="sr-only">Tags:</span>
    {{- if gt $tagCount 0 -}}
    {{- range $index, $tag := $tags -}}
    {{- $normalized := urlize $tag -}}
    {{- $tagPage := site.GetPage (printf "/tags/%s" $normalized) -}}
    {{- $href := cond $tagPage $tagPage.RelPermalink (printf "/tags/%s/" $normalized) -}}
    {{- if $index -}}, {{ end -}}
    <a href="{{ $href }}"><span class="sr-only">Tag:</span>{{ $tag }}</a>
    {{- end -}}
    {{- else -}}
    <span class="post-meta-chip post-meta-chip--untagged" aria-label="This post is untagged">
      Untagged
    </span>
    {{- end -}}
  </span>
  <span class="post-card__separator">â€”</span>
  <span class="post-card__date">
    <span class="sr-only">Published on</span>
    {{- if $dateISO -}}
    <time datetime="{{ $dateISO }}">{{ $dateDisplay }}</time>
    {{- else -}}
    <span>{{ $dateDisplay }}</span>
    {{- end -}}
    {{- if $lastmodDisplay -}}
    <span class="sr-only">Updated on</span>
    <time datetime="{{ $lastmodISO }}">(updated {{ $lastmodDisplay }})</time>
    {{- end -}}
  </span>
</div>
